<!--
  Generated template for the NewticketsPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header class="header-min taigha-dashboard-header">
      <ion-navbar class="no-right">
    <div class="center">
      <i class="back_icon" (click)="back()"></i>
      <p class="title">
        <span class="title-head">Create New Ticket</span>
      </p>
    </div>
  </ion-navbar>
</ion-header>
<ion-content padding>
    <ion-grid class="create-form">
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Template</ion-label>
				<ion-item no-padding no-line class="hasClick" (click)="openSelecttemplate('template')">

					<ion-select class="filter-select" placeholder="Select" [(ngModel)]="TicketTemplate"  (ionChange)="changeTemplate()">
						<ion-option  *ngFor="let template of templates" value="{{template.id}}">{{template.title}}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Type *</ion-label>
				<ion-item no-padding no-line>
					<ion-label>Select Type</ion-label>
					<ion-select class="filter-select" placeholder="Select"  [(ngModel)]="TicketType"  (ionChange)="changeTicketType()">
						<!-- <ion-option  *ngFor="let types of tickettypes" value="types.id">{{types.type}}</ion-option> -->
						
						<ion-option value="customer">Customer</ion-option>
						<ion-option value="internal">Internal</ion-option>
						<ion-option value="partner">Partner</ion-option>
						<ion-option value="task">Task</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Priority *</ion-label>
				<ion-item no-padding no-line>
					<ion-label>Select Priority</ion-label>
					<ion-select class="filter-select" placeholder="Select"  [(ngModel)]="TicketPriority">
						<ion-option value="{{ priority.id }}" *ngFor=" let  priority of priorities  ">{{ priority.priority }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Status *</ion-label>
				<ion-item no-padding no-line>
					<ion-label>Select Status</ion-label>
					<ion-select class="filter-select" placeholder="Select"  [(ngModel)]="TicketStatus">
						<ion-option value="{{ stat.id }}" *ngFor=" let  stat of status  ">{{ stat.status }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Group *</ion-label>
				<ion-item no-padding no-line class="hasClick" (click)="openSelecttemplate('group')">
					<!-- (ionChange)="changeGroup()" -->
					<ion-select class="filter-select" placeholder="Select"  [(ngModel)]="TicketGroup"  >
						<ion-option value="{{ group.id }}" *ngFor=" let  group of groups  ">{{ group.name }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Staff *</ion-label>
				<ion-item no-padding no-line class="hasClick" (click)="openSelecttemplate('staff')">
					<ion-select class="filter-select" placeholder="Select"  [disabled]="!users" [(ngModel)]="TicketStaff">
						<ion-option value="{{ user.id }}" *ngFor=" let  user of users  ">{{ user.first_name }} {{ user.last_name }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line >
	        	<ion-label *ngIf="TicketType == 'customer'">Customer *</ion-label>
	        	<ion-label *ngIf="TicketType != 'customer'">Customer</ion-label>
				<ion-item no-padding no-line class="hasClick" (click)="openSelecttemplate('customer')">
					<ion-select class="filter-select" placeholder="Select"  [(ngModel)]="TicketCustomer"  (ionChange)="changeCustomer()">
						<ion-option value="{{ customer.id }}" *ngFor=" let  customer of customers  ">{{ customer.first_name }} {{ customer.last_name }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Property</ion-label>
	        	<ion-item no-padding no-line class="hasClick" *ngIf="showProperty">
					<ion-select class="filter-select" placeholder="Select" disabled='true' [(ngModel)]="TicketProperty" >
						<ion-option value="{{ property.id }}" *ngFor=" let  property of properties  ">{{ property.address }}</ion-option>
					</ion-select>
				</ion-item>
				<ion-item no-padding no-line class="hasClick"  *ngIf="!showProperty" (click)="openSelecttemplate('property')">
					<ion-select class="filter-select" placeholder="Select" [(ngModel)]="TicketProperty" >
						<ion-option value="{{ property.id }}" *ngFor=" let  property of properties  ">{{ property.address }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row  no-line  *ngIf="showPartner">
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Partner *</ion-label>
				<ion-item no-padding no-line class="hasClick" (click)="openSelecttemplate('partner')">
					<ion-select class="filter-select" placeholder="Select"  [(ngModel)]="TicketPartner">
						<ion-option value="{{ partner.id }}" *ngFor=" let  partner of partners  ">{{ partner.first_name }} {{ partner.last_name }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
	    <ion-row no-line  *ngIf="showCC">
	        <ion-col col-12 no-padding>
	           <ion-label>CC</ion-label>
	        </ion-col>
	        <ion-col col-12 no-padding class="inline-list">
	           <ion-input placeholder="CC"   [(ngModel)]="TicketCC"></ion-input>
	        </ion-col>
        </ion-row>


        <ion-row  no-line *ngIf="showClassVersion">
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Class</ion-label>
				<ion-item no-padding no-line>
					<ion-label>Select Class</ion-label>
					<ion-select class="filter-select" placeholder="Class"   [(ngModel)]="TicketClass">
						<ion-option value="Bug">Bug</ion-option>
						<ion-option value="Enhancement">Enhancement</ion-option>
						<ion-option value="Feature">Feature</ion-option>
						<ion-option value="Question">Question</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
	    </ion-row>
        <ion-row no-line *ngIf="showClassVersion">
	        <ion-col col-12 no-padding>
	           <ion-label>Version</ion-label>
	        </ion-col>
	        <ion-col col-12 no-padding class="inline-list">
	           <ion-input placeholder="Version"  [(ngModel)]="TicketVersion"></ion-input>
	        </ion-col>
        </ion-row>
	    <ion-row no-line>
	        <ion-col col-12 no-padding  no-line>
	        	<ion-label>Access</ion-label>
				<ion-item no-padding no-line  class="hasClick" (click)="openSelecttemplate('access')">
					<ion-label class="display-none">Access</ion-label>
					<ion-select class="filter-select access-select" placeholder="Select"  multiple="true"  [(ngModel)]="TicketAccess">
						<ion-option value="{{ access.id }}" *ngFor=" let  access of accessibleUsers  ">{{ access.first_name }} {{ access.last_name }}</ion-option>
					</ion-select>
				</ion-item>
	        </ion-col>
        </ion-row>
        <ion-row no-line>
	        <ion-col col-12 no-padding>
	           <ion-label>Subject *</ion-label>
	        </ion-col>
	        <ion-col col-12 no-padding class="inline-list">
	           <ion-input placeholder=""   [(ngModel)]="TicketSubject"></ion-input>
	        </ion-col>
        </ion-row>
        <ion-row>
			<ion-col col-12 no-padding>
				<div class="form-field-panel" [class.invalid]="body == '' ">
				<ion-label>Body *</ion-label>
                <quill-editor [style]="{ height: '200px' }" [ngModel]="body" [modules]="{
    toolbar: toolbarOptions
  }" [placeholder] = "'Type here'" (onContentChanged)="getEditorContent($event)" (onEditorCreated)="getEditorInstance($event)"></quill-editor>
             </div>
			</ion-col>
        </ion-row>
        <ion-row>
			<ion-col col-12>
				<div class="form-field-panel">
				<ion-label>Attachments</ion-label>
				<div class="upload-btn-wrapper">
				 <button class="u-btn"><img  src="assets/imgs/upload.svg" width="15" height="15" /> Choose Files</button>
                 <input type="file" class="form-field-input" multiple="multiple" #fileInput (change)="changeListener($event)">
             </div>
             	</div>
             	<div class="conversation-panel-demo" *ngIf="urls.length != 0" >
             		<div class="uploaded-images">
<!--                     <img *ngFor="let url of urls" [src]="url" class="rounded mb-3" width="180"> -->
					  <figure  *ngFor="let url of urls; let i = index " id="uploaded_image_{{ i }}">

					    <span class="delete-icon" (click)="deleteMedia(i, url.name)"><img src="assets/imgs/delete.svg" height="15"></span>
					    <img [src]="url.url" class="rounded mb-3" height="150">

					  </figure>
                </div>
                </div>
			</ion-col>
        </ion-row>
	</ion-grid>
<!-- 	<ion-grid class="form-panel" *ngIf="!showSpinner">

		<ion-row>
			<ion-col col-6>
				<div class="form-field-panel">
					<ion-label class="form-field-label">Property</ion-label>
					<ion-select class="form-field-select" [(ngModel)]="property_id">
					  <ion-option value="" selected>Select</ion-option>
				      <ion-option value="{{ property.id }}" *ngFor=" let  property of properties  ">{{ property.address }}</ion-option>
				    </ion-select>
				</div>
			</ion-col>
			<ion-col col-6>
				<div class="form-field-panel" [class.invalid]="priority == '' ">
					<ion-label class="form-field-label">Priority Status *</ion-label>
					<ion-select class="form-field-select" [(ngModel)]="priority">
					  <ion-option value="" selected>Select</ion-option>
				      <ion-option value="{{ priority.id }}" *ngFor=" let  priority of priorities  ">{{ priority.priority }}</ion-option>
				    </ion-select>
					
				</div>
			</ion-col>
			<ion-col col-12>
				<div class="form-field-panel" [class.invalid]="subject == '' ">
				<ion-label class="form-field-label">Subject *</ion-label>
                 <ion-input class="form-field-input" [(ngModel)]="subject"></ion-input>
             </div>
			</ion-col>
			<ion-col col-12>
				<div class="form-field-panel" [class.invalid]="body == '' ">
				<ion-label class="form-field-label">Body *</ion-label>
                <quill-editor [style]="{ height: '200px' }" [ngModel]="body" [modules]="{
    toolbar: toolbarOptions
  }" [placeholder] = "'Type here'" (onContentChanged)="getEditorContent($event)" (onEditorCreated)="getEditorInstance($event)"></quill-editor>
             </div>
			</ion-col>

			<ion-col col-12>
				<div class="form-field-panel">
				<ion-label class="form-field-label">Attachments</ion-label>
				<div class="upload-btn-wrapper">
				 <button class="u-btn">Choose Files</button>
                 <input type="file" class="form-field-input" multiple="multiple" #fileInput (change)="changeListener($event)">
             </div>
             	</div>
             	<div class="attachment-panel-preview-group">
             		<div class="uploaded-images">
                    <img *ngFor="let url of urls" [src]="url" class="rounded mb-3" width="180">
                </div>
                </div>
			</ion-col>
		</ion-row>
	
			<ion-row class="btn-row">
    	<ion-col col-6><button ion-button block text-uppercase (click)="back()" type="button" class="btn btn-outline-blue">Cancel</button></ion-col>
    	<ion-col col-6><button ion-button block text-uppercase  class="btn btn-blue" (click) = "storeTicket()" [disabled]="">Send</button></ion-col>
    	</ion-row>

	</ion-grid> -->
	<div class="spinner center" *ngIf="showSpinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>
</ion-content>
<div class="sticky-btn">
    <button class="btn btn-hasicon btn-curve clr-btn"  (click)="back()"> 
      Cancel
    </button>
    <button class="btn btn-hasicon btn-curve seehomebtn" (click) = "storeTicket()"> 
      Send
    </button>
    
</div>
